---
layout: post
title: How I Used Apps Scripts to Automate Daily Report Generation
date: '2013-11-03T20:16:00.002+03:00'
author: Fred Muya
tags: 
modified_time: '2013-11-03T20:16:56.831+03:00'
blogger_id: tag:blogger.com,1999:blog-3630098189866392828.post-553810746573266677
blogger_orig_url: http://encore254.blogspot.com/2013/11/how-i-used-apps-scripts-to-automate.html
---

Repetitive tasks… I don’t like them. They get monotonous.That’s what was happening a few days ago, when I was required to create some daily reports on our systems’ health, and upload them to a Google Drive Spreadsheet, i.e., run a few queries on the db, copy the data to the Spreadsheet (probably via a text editor, because Drive doesn't know any other delimiters other than the tab :-(<br />Since the reports will be required daily for the next few weeks, I decided to automate the process. Our InfoSec team said they don’t want us to expose any APIs to any external systems without them being over a private network (P2P, VPN, etc), and APIs would take too much time to build, test, deploy, etc. So here’s what I came up with:<br /><br /><ul><li>Write a PHP script that will be running my queries, saving them in JSON files, and sending me the generated files to my email (that is allowed :-)</li><li>Setup the PHP script as a cron on our servers</li><li>Setup a Gmail filter to detect and give a label to the aforementioned email (We use Google Apps for business)</li><li>Create a Script (on our Google Apps domain), to search my inbox for the email using the given label, fetch the attachments, parse the data and load it into Spreadsheets, then mark the email as read, then archive it.</li><li>Setup the triggers on the script to run daily (like a cron on the cloud)</li><li>Then finally, no more zombie-mode for 10-15 minutes each morning</li></ul><br /><br />So I’d like to share the stuff I did, all the way from the PHP script, to the Apps Script app.<br />Any improvements, criticism, etc will be much appreciated. Let’s get to code… Everything will be available on <a href="https://github.com/muya/jsc-mentions/tree/master/db" target="_blank">GitHub</a><br /><br />For the data, I won’t give you anything from our servers, however we’ll be analyzing how frequently the JSC case came up on the news based on platform and location (don’t ask about the data set, someone gave me a challenge to make Law technical, it’s a start:)<br /><br />So, to get started, check-out/clone the project from https://github.com/muya/jsc-mentions onto any folder on your system. I’ll assume a Unix-based system because… what else?<br /><br /><span style="font-family: Courier New, Courier, monospace;"><b>$ git clone https://github.com/muya/jsc-mentions.git</b></span><br /><br />I’ve provided some generic functions that you may re-use in any of your projects, (thank me later!)<br /><br /><h3>DATA SETUP</h3>The following files can be found under the <b><span style="font-family: Courier New, Courier, monospace;">db</span></b> folder:<br /><br /><ul><li><span style="font-family: Courier New, Courier, monospace;">JSCDatabase.sql</span> - Schema file that will create the database, and the tables required.</li><li><span style="font-family: Courier New, Courier, monospace;">JSCDatabase_with_data.sql</span> - Schema file that will create the database, the tables and load the data</li></ul><br /><br /><b>NB: </b>If you choose to use the schema without data, you can run the load data scripts under the test folder from the terminal.<br /><br />I’ll take you through some basic configurations in <span style="font-family: Courier New, Courier, monospace;">config/_config.php</span>:<br /><br /><ul><li>Ensure you’ve created the path for <span style="font-family: Courier New, Courier, monospace;">LOG_DIRECTORY</span> on your system.</li><li><span style="font-family: Courier New, Courier, monospace;">EMAIL_RECIPIENTS</span> is a pipe-separated list of email addresses that will receive the data in JSON format</li><li><span style="font-family: Courier New, Courier, monospace;">MAILER_USERNAME</span> &amp; <span style="font-family: Courier New, Courier, monospace;">MAILER_EMAIL</span> are the full email addresses of the account that will be used to send the email.</li></ul><br /><br />cd into the directory where you cloned the project and run the command below (make sure you have a working Internet connection):<br /><br /><span style="font-family: Courier New, Courier, monospace;">$ php loadJSCData.php</span><br /><br />If all goes well, you should have an email in your <span style="font-family: Courier New, Courier, monospace;">EMAIL_RECIPIENTS</span> account, having 2 attachments, one for mentions per location and another having mentions per platform.<br /><br />Next step, is set up on Google Apps Scripts:<br /><br /><ul><li>Open Google Drive, and create a new Script</li><li>Select Blank Project</li><li>Replace the contents of Code.gs with the file contents of the file in <span style="font-family: Courier New, Courier, monospace;">appsScripts/LoadJSCMentionsData.gs</span></li><li>Click on Select Function &amp; Choose loadJSCMentionsData</li><li>Run!&nbsp;</li></ul><br /><br /><b>NB:</b> The script will ask for permissions to Manage your email &amp; Google Drive. (Don’t worry, encore254 is NOT affiliated with NSA, NIS, or any Alphabet bodies :)<br /><br />A Spreadsheet will be created in your root Drive folder with the data loaded from the JSON files sent to your email.<br /><br />You’re free to dissect &amp; critic &amp; improve the any aspects of the code. Also suggest any improvements, corrections, etc. via comments on this blog or on <a href="https://github.com/muya/jsc-mentions/tree/master/db" target="_blank">GitHub</a>.<br /><br />Special thanks to <a href="http://www.gdgnairobi.info/" rel="nofollow" target="_blank">GDG Nairobi</a> for the hackathon that introduced me to Google Apps Scripts.<br /><div><br /></div>